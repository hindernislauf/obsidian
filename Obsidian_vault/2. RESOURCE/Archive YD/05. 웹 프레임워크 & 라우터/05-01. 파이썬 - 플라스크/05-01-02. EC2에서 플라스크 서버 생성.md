# EC2에서 플라스크 서버 생성

-  ==vim test01.py 파이썬 파일 생성 ![[스크린샷 2024-05-14 14.45.14.png]]
- ==스크립트 입력 ![[스크린샷 2024-05-14 14.46.45.png]] 
- 입력된 스크립트 실행: pyenv activate py3_11_9 ==> python test01.py
- ==IndentationError: expected an indented block after function definition on line 11 가 발생했음 => 문제점은 vim 스크립트 내에 Identation이 잘못되어 있어서 아래와 같이 수정하였음![[스크린샷 2024-05-14 15.06.46.png]]
- EC2 보안설정에서 인바운드 규칙 추가![[스크린샷 2024-05-14 15.13.54.png]]
- 추가 후 http://퍼블릭IPv4주소:포트번호 웹에 입력 한 후 출력 결과![[스크린샷 2024-05-14 15.15.33.png]]
- 실행 중인 python test01.py 터미널에서 접속 확인![[스크린샷 2024-05-14 15.16.34.png]]
- 새로운 터미널 창 실행 ==> curl -d '{"input":["0.8"]}' -H "Content-Type: application/json" -X POST http://13.124.180.248:5000/predict 실행 후 결과 확인

# NGINX 설치 및 확인
- sudo apt install nginx ![[스크린샷 2024-05-14 15.25.43.png]]
- sudo systemctl status nginx ![[스크린샷 2024-05-14 15.26.33.png]]
# 머신러닝 서버 구축
- gunicorn을 사용해 Flask 어플리케이션 실행 ![[스크린샷 2024-05-14 15.30.45.png]]
	- **test01**: Flask 어플리케이션을 포함하는 파이썬 파일 이름
	- **app**: Flask 어플리케이션 객체 변수 이름
	- **--bind**: 바인딩(binding). 네트워크 엔드포인트에서 통신 준비
	- **0.0.0.0**: 모든 IP 주소 수신
	- **5000**: 포트 5000에서 어플리케이션  실행

- NGINX 파일 수정 ![[스크린샷 2024-05-14 15.39.49.png]]![[스크린샷 2024-05-14 15.37.43.png]]
	- try_files $uri $uri/ =404; 주석 처리 ==> 파일 또는 디렉토리가 존재하지 않으면 404 오류 반환
	- proxy_pass http://127:0.0.1:5000; 코드 추가 ==> nginx에서 받은 HTTP 요청을 해당 IP:Port로 전달


- NGINX 재시작 ![[스크린샷 2024-05-14 15.41.13.png]]
	- 수정 후에는 NGINX를 꼭 재시작 해줘야 함.
	- 재시작 후 status 확인(초록불) ==> **접속 확인(접속 확인 전 AWS 인바운드 규칙 편집에서 HTTP 80번 포트를 추가해줘야 함)**


- gunicorn 백그라운드로 실행 ![[스크린샷 2024-05-14 15.49.38.png]]
	- 백그라운드 실행 전 pyenv activate py3_11_9
	- 14213: gunicorn을 실행하는 부모 프로세스 ID
	- 14314: 실제로 클라이언트 요청을 처리하는 워커 프로세스 (사진에서 찾아볼 것)
	- 종료 방법: kill -9 14213 14314 (부모 프로세스와 워커 프로세스를 함께 kill)
	- kill 후 ps -ef | grep test01로 확인 ![[스크린샷 2024-05-14 15.54.02.png]]


![[E35FD042-4F0E-413F-B60B-ACCB08D85599.png]]
