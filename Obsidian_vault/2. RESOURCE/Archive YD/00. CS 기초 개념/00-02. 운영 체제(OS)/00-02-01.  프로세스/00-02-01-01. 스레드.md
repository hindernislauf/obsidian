# 1. 스레드
스레드는 명령어가 CPU를 통해서 수행되는 객체의 단위이다.


---

하나의 프로세스 내에는 반드시 1개 이상의  스레드가 존재하며, 이러한 스레드는 같은 프로세스에 있는 자원과 상태를 공유한다.


![](https://i.imgur.com/hvSIQeZ.png)

: 프로세스 내에 스레드가 존재하므로, 서로 자원과 상태를 공유할 수 있다.

## 1) 스레드는 왜 필요한가?
: 하나의 프로세스 안에서 여러 개의 루틴을 동시에 수행하면서, 수행 능력을 향상시키려고 할 때 스레드를 사용하게 되는데, 이를 독립적으로 수행하여 처리하려고 할 때 사용하게 된다. 즉 **여러 개의 작업 단위로 구성된 프로그램에서 요청을 동시에 처리하기 위해서**다.


**예를 들어, 워드 프로세서에서 사용자로부터 키보드 입력을 받거나, 그래픽 or UI를 그리고, 문법 오류를 체크하는 등 워드 프로세서 내에서 여러 요청들을 동시에 처리해야 하는데, 이 때 스레드가 필요하다.**


## 2) 스레드의 구성 요소
- 가상 CPU : 인터프리터, 컴파일러에 의해 내부적으로 처리되는 가상 코드.
- 수행 코드 : Thread Class에 구현되어 있는 `run()` Method 코드.
- 처리 데이터 : Thread에서 처리하는 데이터.


## 3) 스레드의 특징

- 프로세스 내에서 실행되는 흐름의 단위이다. 하나의 스레드는 시작해서 종료할 때까지 한번에 하나씩 명령들을 수행한다.
- 각 스레드마다 call stack이 존재(call stack: 실행 중인 서브루틴을 저장하는 자료 구조)하며, 나머지 Code, Data, Heap 영역은 스레드 끼리 공유한다. 반면에 프로세스는 다른 프로세스의 메모리에 직접 접근할 수 없다.
- 스레드는 다른 스레드와 독립적으로 동작한다. 독립적으로 동작하기 때문에 두 개 이상의 스레드가 동작되는 경우, 두 개 이상의 스레드의 실행 및 종료순서는 예측할 수 없다.

---

## 싱글 스레드와 멀티 스레드

![](https://i.imgur.com/fm5ekSY.png)



### (1) 싱글 스레드(Single-Thread)
: 프로세스가 단일 스레드로 동작하는 방식으로, 일련의 처리를 단일 스레드만으로 직렬 처리하는 프로그래밍 방법

하나의 레지스터, 스택으로 표현한다. JavaScript가 가장 대표적인 싱글 스레드 언어이다.
**(예전에 많이 사용하던 방식)** ==> 


![](https://i.imgur.com/0msxuVz.png)


#### 싱글 스레드의 장점
- 자원 접근에 대한 동기화를 신경쓰지 않아도 된다.
	- 여러 개의 스레드가 프로세스 자원을 공유하는 경우, 각 스레드가 원하는 결과를 얻게 하려면 공용 자원에 대한 접근을 제어해야 한다. 쉽게 말해 모든 스레드가 일정 자원에 동시에 접근하거나 똑같은 작업을 하려는 경우, 에러가 발생하거나 원하는 값이 나오지 않는다. 그래서 스레드들이 동시에 같은 자원에 접근하지 못하도록 제어해줘야 한다.
- 동기화를 신경쓰지 않아도 되기 때문에 문맥 교환(context switch) 작업 또한 요구하지 않는다. 문맥 교환은 여러 개의 프로세스가 하나의 프로세서를 공유할 때 발생하는 작업으로 많은 비용을 필요로 한다.
- 프로그래밍 난이도가 쉽고, CPU 메모리를 적게 사용한다.

#### 싱글 스레드의 단점
- 여러 개의 CPU를 활용하지 못한다.
	- 싱글 스레드는 하나의 물리적 코어밖에 사용하지 못한다. 따라서 멀티 코어 머신에서 CPU 사용을 최적화할 수 없다. 최적화를 위해선 Cluster 모듈을 이용해 여러 프로세스를 사용할 수 있다. 하지만 앞서 프로세스끼리의 자원 공유는 어렵기 때문에, Redis와 같은 부가적 인프라가 필요하다.
- 연산량이 많은 작업을 하는 경우, 그 작업이 완료되어야 다른 작업을 수행할 수 있다.
- 싱글 스레드 모델은 에러 처리를 못하는 경우 멈춰버리게 된다. 멀티 스레드 모델은 에러 발생 시 새로운 스레드를 생성하여 극복할 수 있다.

### (2) 멀티 스레드(Multi-Thread)
: 멀티 스레드란 하나의 프로세스 내에서 둘 이상의 스레드가 동시에 작업을 수행하는 것을 의미한다. 나아가 여러 개의 CPU를 사용해 여러 프로세스를 동시에 수행한다는 것이다.




#### 멀티 스레드의 장점
- 싱글 스레드의 경우 작업이 끝나기 전까지 사용자에게 응답하지 않지만, 멀티 스레드의 경우 작업을 분리해서 수행하므로 실시간으로 사용자에게 응답할 수 있다.
- 싱글 스레드인 경우 한 프로세스는 오직 한 프로세서에서만 수행 가능하지만, 멀티 스레드인 경우 한 프로세스를 여러 프로세서에서 수행할 수 있으므로 훨씬 효율적이다.

#### 멀티 스레드의 단점
- 주의 깊은 설계가 필요하며, 디버깅이 까다롭다.
- 단일 프로세스 시스템의 경우 효과를 기대하기 어려우며 다른 프로세스에서 스레드를 제어할 수 없다. (즉, 프로세스 밖에서 스레드 각각을 제어할 수 없다.)
- 멀티 스레드의 경우 자원 공유의 문제가 발생합니다. 하나의 스레드에 문제가 발생하면 전체 프로세스가 영향을 받게 된다.
- 문맥 교환 작업을 요구한다. CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 데 이 과정을 문맥 교환(Context Switching)이라 한다. 문맥 교환이란 다른 태스크(프로세스, 스레드)가 시작할 수 있도록 이미 실행 중인 태스크(프로세스, 스레드)를 멈추는 것을 말한다.


#### 참고 키워드
##### 데드락(Deadlock, 교착 상태)
: 데드락 또는 교착 상태란 한정된 자원을 여러 프로세스가 사용하고자 할 때 발생하는 상황으로, 프로세스가 자원을 얻기 위해 영구적으로 기다리는 상태를 말한다. 예를 들어 다음과 같은 상황에서 데드락이 발생할 수 있다.

ex) 자원 A를 가진 프로세스인 P1과 자원 B를 가진 프로세스 P2가 있을 때, P1이 B를 필요로 하고 P2가 A를 필요로 한다면 두 프로세스는 P1, P2는 서로 자원을 얻기 위해 무한정 기다리게 된다.

1. 데드락의 4가지 조건
	- 주로 멀티 프로그래밍 환경에서 한정된 자원을 얻기 위해 서로 경쟁하는 상황에서 발생한다.
	- 아래 4가지 조건 중 하나라도 충족되지 않으면 데드락이 발생하지 않는다.
	- 비선점(Nonpreemptive): 다른 프로세스의 자원을 뺏을 수 없음
	- 순환 대기(Circular wait): 두 개 이상의 프로세스가 자원 접근을 기다릴 때, 관계가 순환적 구조.
	- 점유 대기(Hold & Wait): 공유 자원에 대한 접근 권한을 가진 채로 다른 자원에 대한 접근 권한을 요구.
	- 상호 배제(Mutual Exclusion): 한 번에 한 프로세스만 공유 자원에 접근 가능하며, 접근 권한이 제한적일 경우.

2. 데드락의 해결 방안


##### 뮤텍스(Mutex), 세마포어(Semaphore)


